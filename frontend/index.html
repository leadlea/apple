<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mac Status PWA</title>
    <meta name="description" content="„Éë„Éº„ÇΩ„Éä„É©„Ç§„Ç∫„Åï„Çå„ÅüMacÁõ£Ë¶ñ„Éª„Çπ„ÉÜ„Éº„Çø„ÇπÂ†±Âëä„ÉÑ„Éº„É´">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#007AFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mac Status">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div id="app">
        <header class="app-header">
            <h1>Mac Status</h1>
            <div class="connection-status" id="connectionStatus">
                <span class="status-indicator"></span>
                <span class="status-text">Êé•Á∂ö‰∏≠...</span>
            </div>
        </header>
        
        <main class="chat-container">
            <!-- System Status Display -->
            <div class="system-status-container" id="systemStatusContainer">
                <div class="status-cards">
                    <div class="status-card cpu-card" id="cpuCard">
                        <div class="status-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <rect x="4" y="4" width="16" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                <rect x="9" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="2"/>
                                <path d="M9 1V3M15 1V3M9 21V23M15 21V23M1 9H3M1 15H3M21 9H23M21 15H23" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="status-content">
                            <div class="status-label">CPU</div>
                            <div class="status-value" id="cpuValue">--</div>
                            <div class="status-bar">
                                <div class="status-bar-fill" id="cpuBar"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="status-card memory-card" id="memoryCard">
                        <div class="status-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M7 8V16M11 8V16M15 8V16M17 8V16" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="status-content">
                            <div class="status-label">„É°„É¢„É™</div>
                            <div class="status-value" id="memoryValue">--</div>
                            <div class="status-bar">
                                <div class="status-bar-fill" id="memoryBar"></div>
                            </div>
                            <div class="status-detail" id="memoryDetail">-- / --</div>
                        </div>
                    </div>
                    
                    <div class="status-card disk-card" id="diskCard">
                        <div class="status-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="status-content">
                            <div class="status-label">„Éá„Ç£„Çπ„ÇØ</div>
                            <div class="status-value" id="diskValue">--</div>
                            <div class="status-bar">
                                <div class="status-bar-fill" id="diskBar"></div>
                            </div>
                            <div class="status-detail" id="diskDetail">-- / --</div>
                        </div>
                    </div>
                </div>
                
                <div class="status-toggle" id="statusToggle">
                    <button class="toggle-btn" id="toggleBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="messages-wrapper">
                <div class="messages" id="messages">
                    <div class="welcome-message">
                        <div class="welcome-icon">üëã</div>
                        <h2>Mac Status „Ç¢„Ç∑„Çπ„Çø„É≥„Éà</h2>
                        <p>„Åì„Çì„Å´„Å°„ÅØÔºÅMac„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Å´„Å§„ÅÑ„Å¶‰Ωï„Åß„ÇÇËÅû„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                        <div class="example-questions">
                            <button class="example-btn" data-question="CPU„ÅÆ‰ΩøÁî®Áéá„ÅØ„Å©„ÅÜ„Åß„Åô„ÅãÔºü">CPU„ÅÆ‰ΩøÁî®Áéá„ÅØ„Å©„ÅÜ„Åß„Åô„ÅãÔºü</button>
                            <button class="example-btn" data-question="„É°„É¢„É™„ÅÆÁä∂Ê≥Å„ÇíÊïô„Åà„Å¶">„É°„É¢„É™„ÅÆÁä∂Ê≥Å„ÇíÊïô„Åà„Å¶</button>
                            <button class="example-btn" data-question="„Ç∑„Çπ„ÉÜ„É†„ÅÆÂÖ®‰ΩìÁöÑ„Å™Áä∂Ê≥Å„ÅØÔºü">„Ç∑„Çπ„ÉÜ„É†„ÅÆÂÖ®‰ΩìÁöÑ„Å™Áä∂Ê≥Å„ÅØÔºü</button>
                        </div>
                    </div>
                </div>
                <div class="scroll-to-bottom" id="scrollToBottom" style="display: none;">
                    <button class="scroll-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M7 14L12 19L17 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Queued messages indicator -->
                <div class="queued-messages-indicator" id="queuedMessagesIndicator">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span id="queuedMessagesCount">0</span> „É°„ÉÉ„Çª„Éº„Ç∏ÂæÖÊ©ü‰∏≠
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator" style="display: none;">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span class="typing-text">„Ç¢„Ç∑„Çπ„Çø„É≥„Éà„ÅåÂÖ•Âäõ‰∏≠...</span>
            </div>
            
            <div class="input-container">
                <div class="message-input-wrapper">
                    <input type="text" id="messageInput" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ..." autocomplete="off" maxlength="500">
                    <div class="input-actions">
                        <button id="clearButton" type="button" class="action-btn" title="Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                <path d="M3 6H21M8 6V4C8 3.44772 8.44772 3 9 3H15C15.5523 3 16 3.44772 16 4V6M19 6V20C19 20.5523 18.4477 21 18 21H6C5.44772 21 5 20.5523 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button id="sendButton" type="button" class="send-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="input-footer">
                    <span class="character-count" id="characterCount">0/500</span>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Scripts -->
    <script src="/static/app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        // Handle PWA shortcuts
        const urlParams = new URLSearchParams(window.location.search);
        const action = urlParams.get('action');
        
        if (action === 'status') {
            // Focus on system status when opened via status shortcut
            document.addEventListener('DOMContentLoaded', () => {
                const statusContainer = document.getElementById('systemStatusContainer');
                if (statusContainer) {
                    statusContainer.scrollIntoView({ behavior: 'smooth' });
                    statusContainer.classList.add('highlight');
                    setTimeout(() => statusContainer.classList.remove('highlight'), 2000);
                }
            });
        } else if (action === 'chat') {
            // Focus on chat input when opened via chat shortcut
            document.addEventListener('DOMContentLoaded', () => {
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.focus();
                }
            });
        }
        
        // Service Worker registration with enhanced error handling
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('New service worker found');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('New service worker installed, update available');
                                }
                            });
                        });
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Handle app shortcuts and protocol handlers
        if ('launchQueue' in window) {
            window.launchQueue.setConsumer((launchParams) => {
                if (launchParams.targetURL) {
                    const url = new URL(launchParams.targetURL);
                    const handler = url.searchParams.get('handler');
                    
                    if (handler) {
                        console.log('Handling protocol:', handler);
                        // Handle custom protocol if needed
                    }
                }
            });
        }
    </script>
</body>
</html>